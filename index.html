<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>Anota Libretas ‚Äî Personaliz√° tu libreta</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
  :root {
    --red:        #a32d29;
    --red-light:  #c74340;
    --blue:       #5ab8bf;
    --peach:      #fddca6;
    --peach-dark: #f8c876;
    --carbon:     #2c2c2c;
    --carbon-soft:#3f3f3f;
    --cream:      #fdf8f2;
    --white:      #ffffff;
    --border:     rgba(44,44,44,0.12);
    --shadow:     0 4px 24px rgba(44,44,44,0.10);
    --shadow-lg:  0 12px 48px rgba(44,44,44,0.16);
  }
  * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
  body { font-family: 'DM Sans', sans-serif; background: var(--cream); color: var(--carbon); min-height: 100vh; overflow-x: hidden; }

  /* HEADER */
  header { background: var(--red); position: relative; overflow: hidden; }
  header::before { content:''; position:absolute; top:-60px; right:-60px; width:260px; height:260px; background:var(--red-light); border-radius:50%; opacity:0.4; }
  header::after  { content:''; position:absolute; bottom:-40px; left:40px; width:160px; height:160px; background:var(--peach); border-radius:50%; opacity:0.15; }
  .header-inner  { position:relative; z-index:1; max-width:780px; margin:0 auto; padding:36px 22px 30px; display:flex; align-items:flex-end; gap:18px; }
  .logo-mark     { width:52px; height:52px; background:var(--peach); border-radius:14px; display:flex; align-items:center; justify-content:center; font-family:'Playfair Display',serif; font-size:24px; color:var(--red); font-weight:700; flex-shrink:0; box-shadow:0 4px 12px rgba(0,0,0,0.2); }
  .header-text h1{ font-family:'Playfair Display',serif; font-size:clamp(20px,5vw,30px); color:var(--white); letter-spacing:-0.5px; line-height:1.1; }
  .header-text p { color:rgba(255,255,255,0.72); font-size:12px; margin-top:4px; font-weight:300; }
  .progress-bar-wrap { background:var(--red-light); height:4px; }
  .progress-bar-fill { height:4px; background:var(--peach); transition:width 0.5s cubic-bezier(.4,0,.2,1); width:0%; }

  main { max-width:780px; margin:0 auto; padding:20px 14px 60px; display:flex; flex-direction:column; gap:14px; }

  /* CARDS */
  .card { background:var(--white); border-radius:16px; overflow:hidden; box-shadow:var(--shadow); animation:fadeSlideIn 0.4s ease both; }
  .card:nth-child(1){animation-delay:.05s} .card:nth-child(2){animation-delay:.10s} .card:nth-child(3){animation-delay:.15s} .card:nth-child(4){animation-delay:.20s} .card:nth-child(5){animation-delay:.25s} .card:nth-child(6){animation-delay:.30s} .card:nth-child(7){animation-delay:.35s}
  .card-header { background:var(--blue); padding:13px 18px; display:flex; align-items:center; gap:11px; }
  .card-header.done { background:var(--red); }
  .step-badge { width:26px; height:26px; background:rgba(255,255,255,0.25); border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:11px; font-weight:600; color:var(--white); flex-shrink:0; }
  .card-header h2 { font-family:'Playfair Display',serif; font-size:16px; color:var(--white); font-weight:700; }
  .card-header .check { margin-left:auto; width:22px; height:22px; background:rgba(255,255,255,0.9); border-radius:50%; display:none; align-items:center; justify-content:center; color:var(--red); font-size:12px; font-weight:700; }
  .card-header.done .check { display:flex; }
  .card-body { padding:16px 18px 18px; display:flex; flex-direction:column; gap:12px; }

  /* SELECTS */
  .select-col { display:flex; flex-direction:column; gap:10px; }
  .select-group { display:flex; flex-direction:column; gap:5px; }
  .select-group label { font-size:11px; font-weight:600; text-transform:uppercase; letter-spacing:0.7px; color:var(--blue); }
  .select-group label .lvl { color:var(--peach-dark); margin-right:3px; }

  select {
    width:100%; padding:12px 38px 12px 14px;
    border:1.5px solid var(--border); border-radius:10px;
    font-family:'DM Sans',sans-serif; font-size:16px;
    color:var(--carbon); background:var(--cream);
    -webkit-appearance:none; appearance:none;
    background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8' viewBox='0 0 12 8'%3E%3Cpath d='M1 1l5 5 5-5' stroke='%235ab8bf' stroke-width='1.8' fill='none' stroke-linecap='round'/%3E%3C/svg%3E");
    background-repeat:no-repeat; background-position:right 14px center;
    cursor:pointer; transition:border-color 0.2s; touch-action:manipulation;
  }
  select:focus { outline:none; border-color:var(--blue); box-shadow:0 0 0 3px rgba(90,184,191,0.15); }
  select.inactive { opacity:0.4; pointer-events:none; background-color:#f0f0f0; }
  select.active   { border-color:var(--blue); background-color:rgba(90,184,191,0.05); }

  .gramaje-display { padding:12px 14px; border:1.5px solid var(--border); border-radius:10px; font-size:14px; color:var(--carbon-soft); background:#f5f5f5; font-family:'DM Sans',sans-serif; font-style:italic; }

  /* LINK REFERENCIA */
  .ref-link { display:inline-flex; align-items:center; gap:6px; font-size:12px; color:var(--red); text-decoration:none; font-weight:500; padding:7px 13px; background:rgba(163,45,41,0.07); border-radius:20px; align-self:flex-start; touch-action:manipulation; }
  .ref-link::before { content:'üîó'; font-size:11px; }

  /* INFO BOX */
  .info-box { background:rgba(253,220,166,0.25); border:1.5px solid var(--peach-dark); border-radius:10px; padding:11px 14px; font-size:12px; color:var(--carbon-soft); line-height:1.5; }

  /* CANVA BANNER */
  .canva-banner { background:linear-gradient(135deg,rgba(90,184,191,0.1),rgba(253,220,166,0.2)); border:1.5px dashed var(--blue); border-radius:12px; padding:14px 15px; display:none; align-items:flex-start; gap:10px; }
  .canva-banner.visible { display:flex; }
  .canva-banner .icon { font-size:20px; flex-shrink:0; margin-top:1px; }
  .canva-banner p { font-size:13px; line-height:1.5; }
  .canva-banner a { color:var(--red); font-weight:600; }

  /* ACCESORIOS */
  .accesorio-item { border:1.5px solid var(--border); border-radius:12px; overflow:hidden; transition:border-color 0.2s, background 0.2s; margin-bottom:2px; }
  .accesorio-item.selected { border-color:var(--blue); background:rgba(90,184,191,0.04); }

  .acc-header {
    display:grid;
    grid-template-columns:auto 1fr auto;
    align-items:center;
    gap:12px;
    padding:14px 16px;
    cursor:pointer;
    touch-action:manipulation;
    -webkit-user-select:none; user-select:none;
    min-height:52px;
  }
  .acc-header:active { background:rgba(90,184,191,0.08); }

  .toggle-switch { width:40px; height:24px; background:#ddd; border-radius:12px; position:relative; transition:background 0.25s; flex-shrink:0; pointer-events:none; }
  .toggle-switch::after { content:''; position:absolute; top:3px; left:3px; width:18px; height:18px; background:white; border-radius:50%; transition:left 0.25s; box-shadow:0 1px 4px rgba(0,0,0,0.25); }
  .accesorio-item.selected .toggle-switch { background:var(--blue); }
  .accesorio-item.selected .toggle-switch::after { left:19px; }

  .accesorio-name { font-size:14px; font-weight:500; line-height:1.3; pointer-events:none; }
  .acc-precio-tag { font-size:11px; color:var(--red); font-weight:700; pointer-events:none; flex-shrink:0; }

  .acc-muestra {
    font-size:11px; color:var(--red); font-weight:600;
    padding:5px 10px; background:rgba(163,45,41,0.08); border-radius:16px;
    white-space:nowrap; pointer-events:none;
    flex-shrink:0;
  }

  .accesorio-detail { display:none; padding:0 16px 14px; }
  .accesorio-item.selected .accesorio-detail { display:block; }

  /* RESUMEN */
  .precio-section { background:var(--white); border-radius:16px; overflow:hidden; box-shadow:var(--shadow-lg); }
  .precio-header { background:var(--red); padding:16px 20px; display:flex; align-items:center; justify-content:space-between; gap:12px; }
  .precio-header h2 { font-family:'Playfair Display',serif; font-size:19px; color:var(--white); }
  .precio-total-badge { background:var(--peach); color:var(--red); font-family:'Playfair Display',serif; font-size:19px; font-weight:700; padding:5px 14px; border-radius:30px; white-space:nowrap; }
  .precio-body { padding:16px 18px; }
  .resumen-lista { display:flex; flex-direction:column; gap:7px; margin-bottom:16px; }
  .resumen-item { display:flex; justify-content:space-between; align-items:flex-start; font-size:13px; padding:8px 11px; background:var(--cream); border-radius:8px; gap:8px; }
  .resumen-item .ri-left { display:flex; flex-direction:column; gap:2px; flex:1; }
  .resumen-item .label { color:var(--carbon-soft); font-size:11px; }
  .resumen-item .valor { font-weight:600; color:var(--carbon); font-size:13px; }
  .resumen-item .precio-item { font-weight:700; color:var(--red); min-width:70px; text-align:right; flex-shrink:0; font-size:13px; }
  .resumen-divider { height:1px; background:var(--border); margin:3px 0; }
  .resumen-total-row { display:flex; justify-content:space-between; align-items:center; padding:12px 11px; background:rgba(163,45,41,0.06); border-radius:10px; border:1.5px solid rgba(163,45,41,0.15); }
  .resumen-total-row .total-label { font-family:'Playfair Display',serif; font-size:15px; font-weight:700; }
  .resumen-total-row .total-precio { font-family:'Playfair Display',serif; font-size:20px; font-weight:700; color:var(--red); }
  .precio-nota { font-size:11px; color:#888; margin-top:10px; text-align:center; font-style:italic; line-height:1.5; }

  .btn-row { display:flex; gap:10px; margin-top:14px; flex-wrap:wrap; }
  .btn { flex:1; min-width:130px; padding:14px 16px; border:none; border-radius:12px; font-family:'DM Sans',sans-serif; font-size:14px; font-weight:600; cursor:pointer; display:flex; align-items:center; justify-content:center; gap:7px; touch-action:manipulation; }
  .btn-primary { background:var(--red); color:white; box-shadow:0 4px 14px rgba(163,45,41,0.35); }
  .btn-secondary { background:var(--peach); color:var(--carbon); }

  .empty-hint { font-size:12px; color:#999; font-style:italic; padding:4px 0 0 2px; display:none; }

  @keyframes fadeSlideIn { from{opacity:0;transform:translateY(8px)} to{opacity:1;transform:translateY(0)} }
  @media print { header::before,header::after{display:none} .card,.precio-section{box-shadow:none;border:1px solid #ddd} .btn-row{display:none} }
</style>
</head>
<body>

<header>
  <div class="header-inner">
    <div class="logo-mark">A</div>
    <div class="header-text">
      <h1>Anota Libretas</h1>
      <p>Personaliz√° tu libreta o agenda ‚ú¶ cada detalle, a tu gusto</p>
    </div>
  </div>
  <div class="progress-bar-wrap"><div class="progress-bar-fill" id="progressBar"></div></div>
</header>

<main>

  <!-- 1. TAMA√ëO -->
  <div class="card">
    <div class="card-header done" id="header-tamanio">
      <div class="step-badge">1</div><h2>Tama√±o de la libreta</h2><div class="check">‚úì</div>
    </div>
    <div class="card-body">
      <div class="select-col">
        <div class="select-group">
          <label><span class="lvl">‚óÜ</span>Tama√±o</label>
          <select id="tamanio" onchange="onTamanioChange()">
            <option value="mm" selected>Medio-Medio Oficio ‚Äî 165√ó108 mm ‚òÖ</option>
            <option value="a5">Medio Oficio / A5 ‚Äî 210√ó148 mm</option>
          </select>
        </div>
        <div class="select-group">
          <label><span class="lvl">‚óÜ</span>Gramaje incluido</label>
          <div class="gramaje-display" id="gramaje-display">75 gr/m¬≤ (√∫nico por ahora)</div>
        </div>
      </div>
      <a href="#" class="ref-link" onclick="return false">Ver referencia de tama√±os</a>
    </div>
  </div>

  <!-- 2. CANTIDAD DE HOJAS -->
  <div class="card">
    <div class="card-header done" id="header-hojas">
      <div class="step-badge">2</div><h2>Cantidad de hojas</h2><div class="check">‚úì</div>
    </div>
    <div class="card-body">
      <div class="select-group">
        <label><span class="lvl">‚óÜ</span>Cantidad</label>
        <select id="hojas" onchange="updateResumen()">
          <option value="104">104 hojas ‚Äî 208 p√°ginas</option>
          <option value="80" selected>80 hojas ‚Äî 160 p√°ginas ‚òÖ</option>
          <option value="64">64 hojas ‚Äî 128 p√°ginas</option>
        </select>
      </div>
      <p style="font-size:12px;color:#999;font-style:italic;">‚òÖ = opci√≥n predeterminada</p>
      <a href="#" class="ref-link" onclick="return false">Ver referencia de espesores</a>
    </div>
  </div>

  <!-- 3. MATERIAL TAPA -->
  <div class="card">
    <div class="card-header" id="header-material">
      <div class="step-badge">3</div><h2>Material de tapa</h2><div class="check">‚úì</div>
    </div>
    <div class="card-body">
      <div class="select-col">
        <div class="select-group">
          <label><span class="lvl">‚óÜ</span>Material</label>
          <select id="mat" onchange="onMatChange()">
            <option value="">‚Äî Eleg√≠ ‚Äî</option>
            <option value="Crea cruda">Crea cruda</option>
            <option value="Lino" selected>Lino ‚òÖ</option>
            <option value="Ecocuero">Ecocuero</option>
            <option value="Papel couch√©">Papel couch√©</option>
          </select>
        </div>
        <div class="select-group">
          <label><span class="lvl">‚ñ∏</span>Sub-opci√≥n</label>
          <select id="mat-sub1" onchange="onMatSub1Change()" class="inactive">
            <option value="">‚Äî Primero eleg√≠ material ‚Äî</option>
          </select>
        </div>
        <div class="select-group">
          <label><span class="lvl">‚ó¶</span>Variante / Color</label>
          <select id="mat-sub2" onchange="updateResumen()" class="inactive">
            <option value="">‚Äî Primero eleg√≠ sub-opci√≥n ‚Äî</option>
          </select>
          <p class="empty-hint" id="hint-mat-sub2">Esta opci√≥n no tiene variantes adicionales.</p>
        </div>
      </div>
      <div class="info-box" id="papel-info" style="display:none">
        üìé Si la tapa lleva imagen o dise√±o personalizado, envialo luego en el chat de la tienda (PNG o archivo de Canva). Resoluci√≥n recomendada: m√≠nimo 300 dpi.
      </div>
      <a href="#" class="ref-link" onclick="return false">Ver muestras de materiales</a>
    </div>
  </div>

  <!-- 4. ENDPAGES -->
  <div class="card">
    <div class="card-header done" id="header-endpages">
      <div class="step-badge">4</div><h2>Endpages (hojas de guarda)</h2><div class="check">‚úì</div>
    </div>
    <div class="card-body">
      <div class="select-col">
        <div class="select-group">
          <label><span class="lvl">‚óÜ</span>Tipo</label>
          <select id="endpage-tipo" onchange="onEndpageTipoChange()">
            <option value="blancas" selected>Blancas ‚òÖ</option>
            <option value="color">Color</option>
          </select>
        </div>
        <div class="select-group" id="group-endpage-color" style="display:none">
          <label><span class="lvl">‚ó¶</span>Color</label>
          <select id="endpage-color" onchange="updateResumen()">
            <option value="Rojo" selected>Rojo ‚òÖ</option>
            <option value="Celeste">Celeste</option>
            <option value="Otro (consultar)">Otro (consultar)</option>
          </select>
        </div>
        <div class="select-group">
          <label><span class="lvl">‚ñ∏</span>Impresi√≥n</label>
          <select id="endpage-imp" onchange="updateResumen()">
            <option value="sin" selected>Sin impresi√≥n ‚òÖ</option>
            <option value="con">Con impresi√≥n</option>
          </select>
        </div>
      </div>
      <div class="info-box" id="endpage-imp-info" style="display:none">
        üìé Si eleg√≠s endpages con impresi√≥n, envi√° el dise√±o luego en el chat de la tienda.
      </div>
      <a href="#" class="ref-link" onclick="return false">Ver ejemplos de endpages</a>
    </div>
  </div>

  <!-- 5. DISE√ëO HOJAS -->
  <div class="card">
    <div class="card-header done" id="header-pers-hojas">
      <div class="step-badge">5</div><h2>Dise√±o de las hojas</h2><div class="check">‚úì</div>
    </div>
    <div class="card-body">
      <div class="select-col">
        <div class="select-group">
          <label><span class="lvl">‚óÜ</span>Tipo de personalizaci√≥n</label>
          <select id="pers-hojas" onchange="onPersHojasChange()">
            <option value="blancas">Hojas blancas</option>
            <option value="base">Usar solo una base</option>
            <option value="patron" selected>Personalizar patr√≥n (hasta 5) ‚òÖ</option>
            <option value="todas">Personalizar todas las hojas</option>
          </select>
        </div>
        <div class="select-group" id="group-base-selector" style="display:none">
          <label><span class="lvl">‚ñ∏</span>Eleg√≠ la base</label>
          <select id="base-selector" onchange="updateResumen()">
            <option value="Base 1 - Agenda 2026">Base 1 ‚Äî Agenda 2026</option>
            <option value="Base 2 - Franjas 3mm" selected>Base 2 ‚Äî Franjas 3 mm ‚òÖ</option>
            <option value="Otra base (consultar)">Otra base (consultar)</option>
          </select>
        </div>
      </div>

      <!-- TINTA -->
      <div id="group-tinta" style="display:none">
        <div style="height:1px;background:var(--border);margin:4px 0 8px"></div>
        <div class="select-col">
          <div class="select-group">
            <label><span class="lvl">‚ñ∏</span>Tipo de impresi√≥n (tinta)</label>
            <select id="tinta-tipo" onchange="updateResumen()">
              <option value="color" selected>A color ‚òÖ</option>
              <option value="mono">Monocromo (m√°s econ√≥mico)</option>
            </select>
          </div>
        </div>
        <div class="info-box" style="margin-top:8px;font-size:11.5px;">
          üí° El costo de tinta depende de la cantidad de hojas y se suma al dise√±o de las hojas.
        </div>
      </div>

      <div class="canva-banner" id="canva-banner">
        <div class="icon">üé®</div>
        <p>Para personalizar las hojas, descarg√° la <a href="#" onclick="return false">base de Canva</a> y editala a tu gusto. Despu√©s enviala junto con tu pedido en el chat de la tienda.</p>
      </div>
      <a href="#" class="ref-link" onclick="return false">Ver ejemplos de dise√±os</a>
    </div>
  </div>

  <!-- 6. ACCESORIOS -->
  <div class="card">
    <div class="card-header" id="header-accesorios">
      <div class="step-badge">6</div><h2>Accesorios opcionales</h2><div class="check">‚úì</div>
    </div>
    <div class="card-body">
      <p style="font-size:13px;color:#888;">Toc√° para activar los accesorios que quer√©s sumar.</p>

      <div class="accesorio-item" id="acc-esq">
        <div class="acc-header" onclick="toggleAcc('esq')">
          <div class="toggle-switch"></div>
          <span class="accesorio-name">Esquineras met√°licas (x4)</span>
          <span class="acc-muestra">üîó Ver muestra</span>
        </div>
        <div class="accesorio-detail">
          <div class="select-group">
            <label><span class="lvl">‚ñ∏</span>Tama√±o</label>
            <select id="esq-tam" onchange="updateResumen()">
              <option value="3x3">Grandes 3√ó3 cm ‚òÖ</option>
              <option value="1.5x1.5">Peque√±as 1.5√ó1.5 cm</option>
            </select>
          </div>
          <div class="select-group" style="margin-top:8px">
            <label><span class="lvl">‚ó¶</span>Color</label>
            <select onchange="updateResumen()"><option>Plateado ‚òÖ</option><option>Dorado</option><option>Otro (consultar)</option></select>
          </div>
        </div>
      </div>

      <div class="accesorio-item" id="acc-cierre">
        <div class="acc-header" onclick="toggleAcc('cierre')">
          <div class="toggle-switch"></div>
          <span class="accesorio-name">Cierre el√°stico</span>
          <span class="acc-muestra">üîó Ver muestra</span>
        </div>
        <div class="accesorio-detail">
          <div class="select-group">
            <label><span class="lvl">‚ó¶</span>Color</label>
            <select onchange="updateResumen()"><option>Negro ‚òÖ</option><option>Celeste</option><option>Otro (consultar)</option></select>
          </div>
        </div>
      </div>

      <div class="accesorio-item" id="acc-portalapiz">
        <div class="acc-header" onclick="toggleAcc('portalapiz')">
          <div class="toggle-switch"></div>
          <span class="accesorio-name">El√°stico portal√°piz</span>
          <span class="acc-muestra">üîó Ver muestra</span>
        </div>
        <div class="accesorio-detail">
          <div class="select-group">
            <label><span class="lvl">‚ó¶</span>Color</label>
            <select onchange="updateResumen()"><option>Negro ‚òÖ</option><option>Celeste</option><option>Otro (consultar)</option></select>
          </div>
        </div>
      </div>

      <div class="accesorio-item" id="acc-porta-cierre">
        <div class="acc-header" onclick="toggleAcc('porta-cierre')">
          <div class="toggle-switch"></div>
          <span class="accesorio-name">Portal√°piz 3D integrado en cierre el√°stico</span>
          <span class="acc-muestra">üîó Ver muestra</span>
        </div>
        <div class="accesorio-detail">
          <div class="select-group">
            <label><span class="lvl">‚ó¶</span>Color</label>
            <select onchange="updateResumen()"><option>Negro ‚òÖ</option><option>Celeste</option><option>Otro (consultar)</option></select>
          </div>
        </div>
      </div>

      <div class="accesorio-item" id="acc-cinta">
        <div class="acc-header" onclick="toggleAcc('cinta')">
          <div class="toggle-switch"></div>
          <span class="accesorio-name">Cinta marcap√°ginas</span>
          <span class="acc-muestra">üîó Ver muestra</span>
        </div>
        <div class="accesorio-detail">
          <div class="select-group">
            <label><span class="lvl">‚ó¶</span>Color</label>
            <select onchange="updateResumen()"><option>Beige ‚òÖ</option><option>Celeste</option><option>Negro</option><option>Rojo</option><option>Otro (consultar)</option></select>
          </div>
        </div>
      </div>

      <div class="accesorio-item" id="acc-dije">
        <div class="acc-header" onclick="toggleAcc('dije')">
          <div class="toggle-switch"></div>
          <span class="accesorio-name">Dije 3D para el√°stico (impreso en 3D)</span>
          <span class="acc-muestra">üîó Ver muestra</span>
        </div>
        <div class="accesorio-detail">
          <div class="select-group">
            <label><span class="lvl">‚ñ∏</span>Dise√±o</label>
            <select id="dije-tipo" onchange="updateResumen()">
              <option value="Hello Kitty">Hello Kitty</option>
              <option value="Texto 2026" selected>Texto 2026 ‚òÖ</option>
              <option value="Otro (consultar)">Otro (consultar)</option>
            </select>
          </div>
          <div class="select-group" style="margin-top:8px">
            <label><span class="lvl">‚ó¶</span>Color</label>
            <select onchange="updateResumen()"><option>Dorado ‚òÖ</option><option>Plateado</option><option>Rosado</option><option>Otro (consultar)</option></select>
          </div>
        </div>
      </div>

      <div class="accesorio-item" id="acc-llavero">
        <div class="acc-header" onclick="toggleAcc('llavero')">
          <div class="toggle-switch"></div>
          <span class="accesorio-name">El√°stico para colgar llaveros</span>
          <span class="acc-muestra">üîó Ver muestra</span>
        </div>
        <div class="accesorio-detail">
          <div class="select-group">
            <label><span class="lvl">‚ó¶</span>Color</label>
            <select onchange="updateResumen()"><option>Celeste ‚òÖ</option><option>Negro</option><option>Otro (consultar)</option></select>
          </div>
        </div>
      </div>

    </div>
  </div>

  <!-- RESUMEN -->
  <div class="precio-section">
    <div class="precio-header">
      <h2>Tu pedido</h2>
      <div class="precio-total-badge" id="total-badge">$ ‚Äî</div>
    </div>
    <div class="precio-body">
      <div class="resumen-lista" id="resumen-lista"></div>
      <p class="precio-nota">‚ö†Ô∏è Los precios son orientativos. Confirm√° el total con Anota Libretas antes de hacer el pedido.</p>
      <div class="btn-row">
        <button class="btn btn-secondary" onclick="copiarResumen()">üìã Copiar resumen</button>
        <button class="btn btn-primary" onclick="window.print()">üñ®Ô∏è Guardar PDF</button>
      </div>
    </div>
  </div>

</main>

<script>
// ‚îÄ‚îÄ PRECIOS (CLP) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// Medio-Medio Oficio
const P_MM = {
  base:2500,
  crea:400, crea_veg:80,
  lino:700, lino_pat:800, lino_velvet:1000,
  eco:1000,
  papel:500, papel_imp_completa:80, papel_imp_simple:20,
  hoj_64:1100, hoj_80:1300, hoj_104:1500,
  ep_blancas:100, ep_color:150, ep_imp:50,
  ph_blancas:0, ph_base:100, ph_patron:200, ph_todas:500,
  esq3:500, esq15:400, cierre:300, portalapiz:200,
  porta_cierre:200, cinta:150, dije:300,
  tinta_color_104:1200, tinta_color_80:900, tinta_color_64:700,
  tinta_mono_104:550,  tinta_mono_80:400,  tinta_mono_64:350,
};
// A5
const P_A5 = {
  base:2500,
  crea:600, crea_veg:100,
  lino:1000, lino_pat:1200, lino_velvet:1500,
  eco:1500,
  papel:750, papel_imp_completa:150, papel_imp_simple:50,
  hoj_64:1300, hoj_80:1800, hoj_104:2300,
  ep_blancas:300, ep_color:400, ep_imp:100,
  ph_blancas:0, ph_base:200, ph_patron:400, ph_todas:600,
  esq3:500, esq15:400, cierre:300, portalapiz:200,
  porta_cierre:200, cinta:150, dije:300,
  tinta_color_104:2300, tinta_color_80:1800, tinta_color_64:1400,
  tinta_mono_104:450,  tinta_mono_80:350,  tinta_mono_64:300,
};

function P() { return document.getElementById('tamanio').value === 'a5' ? P_A5 : P_MM; }

// ‚îÄ‚îÄ DATOS CASCADA MATERIAL ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const matSub1 = {
  'Crea cruda':   ['Sin te√±ir ‚òÖ','Color vegetal'],
  'Lino':         ['Color s√≥lido ‚òÖ','Patrones','Lino velvet s√≥lido'],
  'Ecocuero':     ['Caf√© claro ‚òÖ','Negro','Otro (consultar)'],
  'Papel couch√©': ['Blanco sin impresi√≥n','Impresi√≥n simple','Impresi√≥n completa ‚òÖ'],
};
const matSub2 = {
  'Crea cruda|Sin te√±ir ‚òÖ':                     null,
  'Crea cruda|Color vegetal':                   ['Naranja','Rojo ‚òÖ','Otro (consultar)'],
  'Lino|Color s√≥lido ‚òÖ':                        ['Beige ‚òÖ','Otro (consultar)'],
  'Lino|Patrones':                              ['Franjas rojas y blancas ‚òÖ','Otro (consultar)'],
  'Lino|Lino velvet s√≥lido':                    ['Blanco ‚òÖ','Otro (consultar)'],
  'Ecocuero|Caf√© claro ‚òÖ':                      null,
  'Ecocuero|Negro':                             null,
  'Ecocuero|Otro (consultar)':                  null,
  'Papel couch√©|Blanco sin impresi√≥n':          ['Color lomo: Celeste','Color lomo: Blanco ‚òÖ','Otro (consultar)'],
  'Papel couch√©|Impresi√≥n simple':              ['Color lomo: Celeste','Color lomo: Blanco ‚òÖ','Otro (consultar)'],
  'Papel couch√©|Impresi√≥n completa ‚òÖ':          ['Color lomo: Celeste','Color lomo: Blanco ‚òÖ','Otro (consultar)'],
};
const matDef  = {
  'Crea cruda':'Sin te√±ir ‚òÖ','Lino':'Color s√≥lido ‚òÖ',
  'Ecocuero':'Caf√© claro ‚òÖ','Papel couch√©':'Impresi√≥n completa ‚òÖ'
};
const sub2Def = {
  'Crea cruda|Color vegetal':'Rojo ‚òÖ',
  'Lino|Color s√≥lido ‚òÖ':'Beige ‚òÖ',
  'Lino|Patrones':'Franjas rojas y blancas ‚òÖ',
  'Lino|Lino velvet s√≥lido':'Blanco ‚òÖ',
  'Papel couch√©|Blanco sin impresi√≥n':'Color lomo: Blanco ‚òÖ',
  'Papel couch√©|Impresi√≥n simple':'Color lomo: Blanco ‚òÖ',
  'Papel couch√©|Impresi√≥n completa ‚òÖ':'Color lomo: Blanco ‚òÖ',
};

// ‚îÄ‚îÄ HELPERS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function setActive(sel, active) {
  sel.classList.toggle('inactive', !active);
  sel.classList.toggle('active', active);
}
function poblarSelect(sel, opciones, defVal) {
  sel.innerHTML = '';
  opciones.forEach(o => {
    const op = document.createElement('option');
    op.value = o; op.textContent = o; sel.appendChild(op);
  });
  if (defVal && sel.querySelector(`option[value="${defVal}"]`)) sel.value = defVal;
}

// ‚îÄ‚îÄ CASCADA MATERIAL ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function onMatChange() {
  const mat  = document.getElementById('mat').value;
  const s1   = document.getElementById('mat-sub1');
  const s2   = document.getElementById('mat-sub2');
  const hint = document.getElementById('hint-mat-sub2');
  const info = document.getElementById('papel-info');

  hint.style.display = 'none';
  s1.innerHTML = '<option value="">‚Äî Eleg√≠ sub-opci√≥n ‚Äî</option>';
  s2.innerHTML = '<option value="">‚Äî Eleg√≠ variante ‚Äî</option>';
  setActive(s1, false); setActive(s2, false);
  info.style.display = mat === 'Papel couch√©' ? 'block' : 'none';

  if (!mat) { updateResumen(); return; }
  poblarSelect(s1, matSub1[mat] || [], matDef[mat]);
  setActive(s1, true);
  onMatSub1Change();
}

function onMatSub1Change() {
  const mat  = document.getElementById('mat').value;
  const sub1 = document.getElementById('mat-sub1').value;
  const s2   = document.getElementById('mat-sub2');
  const hint = document.getElementById('hint-mat-sub2');

  hint.style.display = 'none';
  s2.innerHTML = '<option value="">‚Äî Eleg√≠ variante ‚Äî</option>';
  setActive(s2, false);

  if (!sub1) { updateResumen(); return; }

  const key  = mat + '|' + sub1;
  const opts = matSub2[key];
  if (!opts) { hint.style.display = 'block'; updateResumen(); return; }
  poblarSelect(s2, opts, sub2Def[key]);
  setActive(s2, true);
  updateResumen();
}

// ‚îÄ‚îÄ TAMA√ëO ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function onTamanioChange() {
  // Ajustar opciones de hojas seg√∫n tama√±o
  const t = document.getElementById('tamanio').value;
  const hSel = document.getElementById('hojas');
  const curVal = hSel.value;
  hSel.innerHTML = '';
  const opts104 = t === 'a5'
    ? [{v:'104',l:'104 hojas ‚Äî 208 p√°ginas'},{v:'80',l:'80 hojas ‚Äî 160 p√°ginas ‚òÖ'},{v:'64',l:'64 hojas ‚Äî 128 p√°ginas'}]
    : [{v:'104',l:'104 hojas ‚Äî 208 p√°ginas'},{v:'80',l:'80 hojas ‚Äî 160 p√°ginas ‚òÖ'},{v:'64',l:'64 hojas ‚Äî 128 p√°ginas'}];
  opts104.forEach(o => {
    const op = document.createElement('option');
    op.value = o.v; op.textContent = o.l; hSel.appendChild(op);
  });
  hSel.value = curVal || '80';
  updateResumen();
}

// ‚îÄ‚îÄ ENDPAGES ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function onEndpageTipoChange() {
  const v = document.getElementById('endpage-tipo').value;
  document.getElementById('group-endpage-color').style.display = v === 'color' ? 'block' : 'none';
  updateResumen();
}

// ‚îÄ‚îÄ DISE√ëO HOJAS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function onPersHojasChange() {
  const v = document.getElementById('pers-hojas').value;
  document.getElementById('group-base-selector').style.display = v === 'base' ? 'block' : 'none';
  document.getElementById('canva-banner').classList.toggle('visible', v === 'patron' || v === 'todas');
  document.getElementById('group-tinta').style.display = v !== 'blancas' ? 'block' : 'none';
  updateResumen();
}

// ‚îÄ‚îÄ ACCESORIOS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function toggleAcc(id) {
  document.getElementById('acc-' + id).classList.toggle('selected');
  updateResumen();
}

const ACC_LIST = [
  {id:'esq',         label:'Esquineras met√°licas (x4)',           pk:'esq_pk'},
  {id:'cierre',      label:'Cierre el√°stico',                     pk:'cierre'},
  {id:'portalapiz',  label:'El√°stico portal√°piz',                 pk:'portalapiz'},
  {id:'porta-cierre',label:'Portal√°piz 3D en cierre',             pk:'porta_cierre'},
  {id:'cinta',       label:'Cinta marcap√°ginas',                  pk:'cinta'},
  {id:'dije',        label:'Dije 3D para el√°stico',               pk:'dije'},
  {id:'llavero',     label:'El√°stico para colgar llaveros',       pk:'cierre'}, // mismo precio que cierre (consultar, no en tabla)
];

function getAccSel() {
  return ACC_LIST.filter(a => document.getElementById('acc-'+a.id)?.classList.contains('selected'));
}

// ‚îÄ‚îÄ C√ÅLCULO PRECIOS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function getPMat() {
  const mat  = document.getElementById('mat').value;
  const sub1 = document.getElementById('mat-sub1').value;
  const p    = P();
  if (!mat) return 0;
  if (mat === 'Crea cruda') {
    let base = p.crea;
    if (sub1 === 'Color vegetal') base += p.crea_veg;
    return base;
  }
  if (mat === 'Lino') {
    if (sub1 === 'Patrones') return p.lino_pat;
    if (sub1 === 'Lino velvet s√≥lido') return p.lino_velvet;
    return p.lino;
  }
  if (mat === 'Ecocuero') return p.eco;
  if (mat === 'Papel couch√©') {
    let base = p.papel;
    if (sub1 === 'Impresi√≥n completa ‚òÖ') base += p.papel_imp_completa;
    if (sub1 === 'Impresi√≥n simple')    base += p.papel_imp_simple;
    return base;
  }
  return 0;
}
function getPHojas() {
  const h = document.getElementById('hojas').value;
  return P()['hoj_' + h] || 0;
}
function getPEndpages() {
  const tipo = document.getElementById('endpage-tipo').value;
  const imp  = document.getElementById('endpage-imp').value;
  const p    = P();
  let total  = tipo === 'color' ? p.ep_color : p.ep_blancas;
  if (imp === 'con') total += p.ep_imp;
  return total;
}
function getPPerso() { return P()['ph_' + document.getElementById('pers-hojas').value] || 0; }
function getPTinta() {
  const v = document.getElementById('pers-hojas').value;
  if (v === 'blancas') return 0;
  const h  = document.getElementById('hojas').value;
  const tipo = document.getElementById('tinta-tipo')?.value || 'color';
  const p  = P();
  const key = tipo === 'mono' ? 'tinta_mono_' : 'tinta_color_';
  return p[key + h] || 0;
}
function getEsqPrecio() {
  const tam = document.getElementById('esq-tam')?.value || '3x3';
  return tam === '1.5x1.5' ? P().esq15 : P().esq3;
}
function fmt(n) { return n !== undefined && n !== null ? '$ ' + n.toLocaleString('es-CL') : '$ ‚Äî'; }

// ‚îÄ‚îÄ RESUMEN ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function updateResumen() {
  const lista = document.getElementById('resumen-lista');
  lista.innerHTML = '';

  const p    = P();
  const mat  = document.getElementById('mat').value || '‚Äî';
  const sub1 = document.getElementById('mat-sub1').value || '';
  const sub2 = document.getElementById('mat-sub2').value || '';
  const t    = document.getElementById('tamanio').value;
  const tamLbl = t === 'a5' ? 'Medio Oficio / A5 ‚Äî 210√ó148 mm' : 'Medio-Medio Oficio ‚Äî 165√ó108 mm';
  const hojSel = document.getElementById('hojas');
  const hojLbl = hojSel.options[hojSel.selectedIndex]?.text.replace(' ‚òÖ','') || '';
  const phSel  = document.getElementById('pers-hojas');
  const phLbl  = phSel.options[phSel.selectedIndex]?.text.replace(' ‚òÖ','') || '';
  const bSel   = document.getElementById('base-selector');
  const phDisp = phSel.value === 'base' ? (bSel.options[bSel.selectedIndex]?.text.replace(' ‚òÖ','') || '') : phLbl;
  const matLbl = [mat, sub1, sub2].map(s=>s.replace(' ‚òÖ','')).filter(Boolean).join(' ‚Ä∫ ');

  // Endpages
  const epTipo = document.getElementById('endpage-tipo');
  const epColor= document.getElementById('endpage-color');
  const epImp  = document.getElementById('endpage-imp');
  let epLbl    = epTipo.options[epTipo.selectedIndex]?.text.replace(' ‚òÖ','') || '';
  if (epTipo.value === 'color') epLbl += ' ‚Äî ' + (epColor.options[epColor.selectedIndex]?.text.replace(' ‚òÖ','') || '');
  if (epImp.value === 'con') epLbl += ' ¬∑ con impresi√≥n';

  const pM = getPMat(), pH = getPHojas(), pE = getPEndpages(), pP = getPPerso(), pT = getPTinta();
  let total = p.base + pM + pH + pE + pP + pT;

  const rows = [
    {label:'Armado y encuadernaci√≥n', valor:'Precio base',     precio:p.base},
    {label:'Tama√±o',                  valor:tamLbl,            precio:0, noPrice:true},
    {label:'Cantidad de hojas',       valor:hojLbl + ' ¬∑ 75 gr/m¬≤', precio:pH},
    {label:'Material de tapa',        valor:matLbl,            precio:pM},
    {label:'Endpages',                valor:epLbl,             precio:pE},
    {label:'Dise√±o de hojas',         valor:phDisp,            precio:pP},
    {label:'Tinta de impresi√≥n',      valor:pT===0?'Sin tinta (hojas blancas)': (document.getElementById('tinta-tipo')?.value==='mono'?'Monocromo':'A color'), precio:pT, hide:pT===0},
  ];

  rows.forEach(r => {
    if (r.hide) return;
    if (r.noPrice) {
      lista.insertAdjacentHTML('beforeend',
        `<div class="resumen-item">
          <div class="ri-left"><span class="label">${r.label}</span><span class="valor">${r.valor}</span></div>
          <span class="precio-item" style="color:#aaa">incl.</span>
        </div>`);
    } else {
      lista.insertAdjacentHTML('beforeend',
        `<div class="resumen-item">
          <div class="ri-left"><span class="label">${r.label}</span><span class="valor">${r.valor}</span></div>
          <span class="precio-item">${fmt(r.precio)}</span>
        </div>`);
    }
  });

  const accs = getAccSel();
  if (accs.length > 0) {
    lista.insertAdjacentHTML('beforeend', '<div class="resumen-divider"></div>');
    accs.forEach(a => {
      const accEl = document.getElementById('acc-'+a.id);
      const selects = accEl?.querySelectorAll('select') || [];
      const colorVal = (selects[selects.length-1]?.value || '').replace(' ‚òÖ','');
      let extra = colorVal;
      // esq: mostrar tama√±o
      if (a.id === 'esq') {
        const tam = document.getElementById('esq-tam')?.value.replace(' ‚òÖ','') || '';
        extra = tam + (colorVal ? ' ‚Äî ' + colorVal : '');
      }
      // dije: mostrar dise√±o
      if (a.id === 'dije') {
        const dijeT = document.getElementById('dije-tipo')?.value.replace(' ‚òÖ','') || '';
        extra = dijeT + (colorVal ? ' ‚Äî ' + colorVal : '');
      }
      const pp = a.pk === 'esq_pk' ? getEsqPrecio() : (p[a.pk] || 0);
      total += pp;
      lista.insertAdjacentHTML('beforeend',
        `<div class="resumen-item">
          <div class="ri-left"><span class="label">+ ${a.label}</span><span class="valor">${extra}</span></div>
          <span class="precio-item">${fmt(pp)}</span>
        </div>`);
    });
  }

  lista.insertAdjacentHTML('beforeend',
    `<div class="resumen-total-row">
      <span class="total-label">Total estimado</span>
      <span class="total-precio">${fmt(total)}</span>
    </div>`);
  document.getElementById('total-badge').textContent = fmt(total);

  // Progress (6 secciones principales)
  let done = 0;
  done += 1; // tama√±o siempre ok
  done += 1; // hojas siempre ok
  if (document.getElementById('mat').value) done++;
  done += 1; // endpages siempre ok
  done += 1; // dise√±o hojas siempre ok
  if (accs.length > 0) done++;
  document.getElementById('progressBar').style.width = Math.round((done/6)*100) + '%';

  // Card done states
  const map = {
    'header-tamanio':true,
    'header-hojas':true,
    'header-material':!!document.getElementById('mat').value,
    'header-endpages':true,
    'header-pers-hojas':true,
    'header-accesorios':accs.length>0
  };
  Object.entries(map).forEach(([id,v]) => document.getElementById(id)?.classList.toggle('done', v));
}

// ‚îÄ‚îÄ COPIAR RESUMEN ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function copiarResumen() {
  const t    = document.getElementById('tamanio').value;
  const tamL = t==='a5'?'Medio Oficio / A5 ‚Äî 210√ó148 mm':'Medio-Medio Oficio ‚Äî 165√ó108 mm';
  const mat  = document.getElementById('mat').value||'‚Äî';
  const sub1 = document.getElementById('mat-sub1').value||'';
  const sub2 = document.getElementById('mat-sub2').value||'';
  const hS   = document.getElementById('hojas');
  const phS  = document.getElementById('pers-hojas');
  const epT  = document.getElementById('endpage-tipo');
  const accs = getAccSel();

  let txt = '‚ú¶ PEDIDO ‚Äî ANOTA LIBRETAS ‚ú¶\n\n';
  txt += 'üìê Tama√±o: ' + tamL + '\n';
  txt += 'üìÑ Hojas: ' + (hS.options[hS.selectedIndex]?.text.replace(' ‚òÖ','') || '') + ' ¬∑ 75 gr/m¬≤\n';
  txt += 'üìö Material tapa: ' + [mat,sub1,sub2].map(s=>s.replace(' ‚òÖ','')).filter(Boolean).join(' ‚Ä∫ ') + '\n';
  txt += 'üóíÔ∏è Endpages: ' + (epT.options[epT.selectedIndex]?.text.replace(' ‚òÖ','') || '') + '\n';
  txt += 'üé® Dise√±o hojas: ' + (phS.options[phS.selectedIndex]?.text.replace(' ‚òÖ','') || '') + '\n';
  if (accs.length > 0) {
    txt += '\nüéÄ Accesorios:\n';
    accs.forEach(a => {
      const c = document.getElementById('acc-'+a.id)?.querySelector('select')?.value.replace(' ‚òÖ','')||'';
      txt += '  ‚Ä¢ ' + a.label + (c ? ' ‚Äî ' + c : '') + '\n';
    });
  }
  txt += '\nüí∞ Total estimado: ' + document.getElementById('total-badge').textContent;
  txt += '\n\n‚ö†Ô∏è Precio orientativo. Confirm√° el total con Anota Libretas.';

  navigator.clipboard.writeText(txt).then(() => {
    const b = event.target.closest('button'), o = b.textContent;
    b.textContent = '‚úì ¬°Copiado!';
    setTimeout(() => b.textContent = o, 2000);
  }).catch(() => prompt('Copi√° este texto:', txt));
}

// ‚îÄ‚îÄ INIT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
onMatChange();
onPersHojasChange();
onEndpageTipoChange();
updateResumen();
</script>
</body>
</html>
